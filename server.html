<html>
<head>
  <title>PeerJS - Monitor</title>
  <meta charset="utf-8">
  <!-- <link rel="stylesheet" href="style.css"> -->
  <script type="text/javascript" src="jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="peer.js"></script>
  <script>

  // This object will take in an array of XirSys STUN / TURN servers
  // and override the original config object
  var customConfig;

  // Call XirSys ICE servers
  $.ajax({
    url: "https://service.xirsys.com/ice",
    data: {
      ident: "yaozhifeng",
      secret: "24161d72-2520-11e5-b500-d1d647416263",
      domain: "eztest.cn",
      application: "default",
      room: "default",
      secure: 1
    },
    success: function (data, status) {
      // data.d is where the iceServers object lives
      customConfig = data.d;
      console.log(customConfig);
    },
    async: false
  });

  console.info('stun server: ' + customConfig);
  
  // PeerJS object
  var peer = new Peer({
    key: '5b04aiqai14kuik9',
    debug: 3,
    config: customConfig
  });
    // PeerJS object
    // var peer = new Peer({ key: 'lwjd5qra8257b9', debug: 3, config: {'iceServers': [
    //   { url: 'stun:stun.l.google.com:19302' } // Pass in optional STUN and TURN server for maximum network compatibility
    // ]}});
    
    peer.on('call', function(mediaConn) {
        console.info('incoming call');
        mediaConn.on('stream', function(stream){
            $('#my-video').prop('src', URL.createObjectURL(stream));
        });
        mediaConn.answer();
    });

    $(function(){
        $("#conn").click(function(){
            peer_id = $('#peer-id').val();
            console.info(peer_id);
            conn = peer.connect(peer_id);
            console.info(conn);
        });
    });


  </script>


</head>

<body>

  <div class="pure-g">
      <input type="text" id="peer-id"><button id='conn'>Connect</button>

      <!-- Video area -->
      <div class="pure-u-2-3" id="video-container">
        <video id="my-video" muted="true" autoplay></video>
      </div>

  </div>


</body>
</html>
